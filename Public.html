<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>INTRODUCTION TO DPLYR FOR ACTUARIES</title>

<script src="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fusers%24%2Fthsteed%2Fdocuments%2FR%2Fwin%2Dlibrary%2F3%2E5%2Frmarkdown%2Frmd%2Fh%2Fjquery%2Fjquery%2Emin%2Ejs%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fusers%24%2Fthsteed%2Fdocuments%2FR%2Fwin%2Dlibrary%2F3%2E5%2Frmarkdown%2Frmd%2Fh%2Fbootstrap%2Fcss%2Fbootstrap%2Emin%2Ecss%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A" rel="stylesheet" />
<script src="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fusers%24%2Fthsteed%2Fdocuments%2FR%2Fwin%2Dlibrary%2F3%2E5%2Frmarkdown%2Frmd%2Fh%2Fbootstrap%2Fjs%2Fbootstrap%2Emin%2Ejs%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A"></script>
<script src="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fusers%24%2Fthsteed%2Fdocuments%2FR%2Fwin%2Dlibrary%2F3%2E5%2Frmarkdown%2Frmd%2Fh%2Fbootstrap%2Fshim%2Fhtml5shiv%2Emin%2Ejs%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A"></script>
<script src="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fusers%24%2Fthsteed%2Fdocuments%2FR%2Fwin%2Dlibrary%2F3%2E5%2Frmarkdown%2Frmd%2Fh%2Fbootstrap%2Fshim%2Frespond%2Emin%2Ejs%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A"></script>
<script src="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fusers%24%2Fthsteed%2Fdocuments%2FR%2Fwin%2Dlibrary%2F3%2E5%2Frmarkdown%2Frmd%2Fh%2Fnavigation%2D1%2E1%2Ftabsets%2Ejs%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A"></script>
<link href="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fusers%24%2Fthsteed%2Fdocuments%2FR%2Fwin%2Dlibrary%2F3%2E5%2Frmarkdown%2Frmd%2Fh%2Fhighlightjs%2Fdefault%2Ecss%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A" rel="stylesheet" />
<script src="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fusers%24%2Fthsteed%2Fdocuments%2FR%2Fwin%2Dlibrary%2F3%2E5%2Frmarkdown%2Frmd%2Fh%2Fhighlightjs%2Fhighlight%2Ejs%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A"></script>
<link href="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fusers%24%2Fthsteed%2Fdocuments%2FR%2Fwin%2Dlibrary%2F3%2E5%2Frmarkdown%2Frmd%2Fh%2Fpagedtable%2D1%2E1%2Fcss%2Fpagedtable%2Ecss%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A" rel="stylesheet" />
<script src="data:text/html; charset=iso-8859-1,%3C%21DOCTYPE%20HTML%20PUBLIC%20%22%2D%2F%2FIETF%2F%2FDTD%20HTML%202%2E0%2F%2FEN%22%3E%0A%3Chtml%3E%3Chead%3E%0A%3Ctitle%3E404%20Not%20Found%3C%2Ftitle%3E%0A%3C%2Fhead%3E%3Cbody%3E%0A%3Ch1%3ENot%20Found%3C%2Fh1%3E%0A%3Cp%3EThe%20requested%20URL%20%2Fusers%24%2Fthsteed%2Fdocuments%2FR%2Fwin%2Dlibrary%2F3%2E5%2Frmarkdown%2Frmd%2Fh%2Fpagedtable%2D1%2E1%2Fjs%2Fpagedtable%2Ejs%20was%20not%20found%20on%20this%20server%2E%3C%2Fp%3E%0A%3C%2Fbody%3E%3C%2Fhtml%3E%0A"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type="text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">INTRODUCTION TO DPLYR FOR ACTUARIES</h1>

</div>


<div id="background---no-coding-zone" class="section level2">
<h2>BACKGROUND - NO CODING ZONE</h2>
<ul>
<li>Coding in R is really just calling a series of functions</li>
<li>There are thousands of functions available in R and the total increases daily</li>
<li>This is what makes R so powerful - but also intimidating</li>
<li>Some functions are available just by opening R - but it would be inefficient to include them all</li>
<li><p>You need to determine which external functions you want to use for each project</p></li>
<li>Lesson 1 attempts to simplify R a little bit</li>
<li>We will focus on only 6 functions that will address the majority of common actuarial needs</li>
<li>These functions (along with others not covered here) are bundled together in the dplyr package</li>
<li><p>Terminology: a package is simply a bundle of external functions</p></li>
</ul>
</div>
<div id="the-6-dplyr-functions-covered-in-lesson-1" class="section level1">
<h1>THE 6 DPLYR FUNCTIONS COVERED IN LESSON 1</h1>
<ul>
<li>Group_by and summarise: Use these together to get totals by groups</li>
<li>Mutate: Add a new column</li>
<li>Inner Join: Join tables together</li>
<li>Filter: Filter specific rows</li>
<li>Select: Select specific columns</li>
</ul>
<p>END OF THE BACKGROUND INFO - NOW LET’S BEGIN OUR SCRIPT</p>
</div>
<div id="steps-to-create-a-new-r-script" class="section level1">
<h1>3 STEPS TO CREATE A NEW R SCRIPT</h1>
<ol style="list-style-type: decimal">
<li>Create a dedicated working directory. Save associated data here.</li>
<li>Open RStudio - open a new script - save it to directory from #1.</li>
<li>Set working directory to source file directory.</li>
</ol>
<p>NOW YOU ARE READY TO START CODING</p>
</div>
<div id="task-1-import-required-packages" class="section level1">
<h1>TASK 1: IMPORT REQUIRED PACKAGES</h1>
<p>Install the packages you need for this specific project.</p>
<pre class="r"><code># install.packages('dplyr')
library(dplyr)
library(data.table)</code></pre>
<p>DECONSTRUCT THE CODE ABOVE:</p>
<ul>
<li>Interpret install.packages() function as “save a local copy of(this external CRAN package)”</li>
<li>Interpret library() function as “for this working session of R activate (this locally saved package)”</li>
<li>Notice how R is structured: function(argument(s))</li>
</ul>
<p>You only need to install a local copy of a package once. You need to activate selected packages every session. Best practice is to begin any script with the packages you will need for your task at hand. For this exercise, we need the dplyr package (no surprise) and the data.table package (explained below).</p>
</div>
<div id="task-2-read-in-your-data" class="section level1">
<h1>TASK 2: READ IN YOUR DATA</h1>
<p>Import the dataset(s) that you will be working with.</p>
<pre class="r"><code>data.valyear &lt;- read.csv('valyear_mapping.csv')
data.mortality &lt;- fread('mortality.csv')</code></pre>
<p>DECONSTRUCT THE CODE ABOVE:</p>
<ul>
<li>Left arrow should be read as “Create a new object”.</li>
<li>Note the 2 functions used for reading in our data: fread() and read.csv()</li>
<li>Interpret read.csv() as “import into this active R session(this file)”</li>
<li>Interpret fread() as “import into this active R session(this file - and do it faster than read.csv() would)”</li>
<li>Why not just use the quicker fread() every time? It is not internal - requires us to load data.table - read.csv() is internal</li>
</ul>
<p>TRANSLATE THE CODE TO ENGLISH:</p>
<ul>
<li>Create a new object called data.valyear by not so quickly reading in valyear_mapping.csv</li>
<li>Create a new object called data.mortality by quickly reading in mortality.csv</li>
<li>This code snippet involves 2 lines that each need to be run separately (more on that later)</li>
<li>We did not need to specify a directory in our code because these files are in our working directory.</li>
</ul>
<p>Once you import the data - you can see your 2 new objects in the upper right hand console.</p>
<ul>
<li>data.mortality: 1,472599 rows with 34 columns</li>
<li>data.valyear: 7 rows of 2 columns</li>
</ul>
</div>
<div id="task-3-group_by-and-summarise" class="section level1">
<h1>TASK 3: GROUP_BY AND SUMMARISE</h1>
<p>Calculate total deaths and expected deaths by count for each valuation year. For expected deaths use the 2015 table.</p>
<pre class="r"><code>data.grouped &lt;- data.mortality %&gt;%
  group_by(Val.Year) %&gt;%
  summarise(actual = sum(Deaths), expected = sum(qx2015VBT.policy))</code></pre>
<p>DECONSTRUCT THE CODE ABOVE:</p>
<ul>
<li>%&gt;% this is called a pipe. If you see this symbol - know that dplyr is being used.</li>
<li>Whenever you see a pipe - interpret it as saying “THEN”.<br />
</li>
<li>Code snippets that are piped together will be run together - unlike the data import above.</li>
<li>Review: left-hand arrow means create a new object.</li>
<li>Interpret group_by() as “combine your dataset(into these levels)”</li>
<li>Interpret summarise() as “Sum totals within each group_by cohort(these are the values to sum)”</li>
</ul>
<p>TRANSLATE THE CODE TO ENGLISH:</p>
<ul>
<li>Create a new object named data.grouped as follows:</li>
<li>Start with data.mortality THEN</li>
<li>Group by Valuation Year THEN</li>
<li>Sum total Deaths and call it actual, Sum the 2015VBT table qx values and call that expected</li>
</ul>
<p>Notice that we now have a new object called data.grouped in our upper right panel. This object has 7 rows and 3 variables. Click on it for further inspection reveals the columns are Val.year, actual, and expected, as suspected.</p>
</div>
<div id="task-4-mutate" class="section level1">
<h1>TASK 4: MUTATE</h1>
<p>Caclculate the Actual to Expected mortality ratios by valuation year.</p>
<pre class="r"><code>data.grouped &lt;- data.grouped %&gt;%
  mutate(a.to.e = actual/expected)</code></pre>
<p>DECONSTRUCT THE CODE ABOVE:</p>
<ul>
<li>Interpret mutate() as “create new variable (defined here)”</li>
<li>In this case, the new variable is called a.to.e and is set equal to actual divided by expected.</li>
</ul>
<p>TRANSLATE THE CODE TO ENGLISH:</p>
<ul>
<li>Create a new object called data .grouped as follows:</li>
<li>Begin with the object data.grouped THEN</li>
<li>Create a new variable - call the variable a.to.e - calculated as actual divided by expected.</li>
</ul>
<p>Notice that after running this code - the object data.grouped has an additional variable - as expected.</p>
</div>
<div id="task-5-inner_join" class="section level1">
<h1>TASK 5: INNER_JOIN</h1>
<p>Map the 6 Valuation Years into 3 underwriting regimes as Follows:</p>
<ul>
<li>VALUATION YEAR &lt; 2012: A</li>
<li>VALUATION YEAR 2012-2013: B</li>
<li>VALUATION YEAR 2014+: C</li>
</ul>
<pre class="r"><code>data.grouped &lt;- data.grouped %&gt;%
  inner_join(data.valyear, by = 'Val.Year')</code></pre>
<p>DECONSTRUCT THE CODE ABOVE:</p>
<ul>
<li>Interpret function inner_join() as “perform an inner join on previous table(with new table as defined)”</li>
<li>most common type of join that I use - when I want to keep all rows from both tables</li>
</ul>
<p>TRANSLATE THE CODE TO ENGLISH:</p>
<ul>
<li>Create a new object called data.grouped</li>
<li>To create that object - start with data.grouped THEN</li>
<li>Join the data.valyear table by the column “Val.Year”</li>
</ul>
<p>As with everything in R - there is more than one way to accomplish this task. Below demonstrates the use of the command “ifelse” in conjunction with the mutate function we already saw. The end result is the same, so both methods are correct. A table makes more sense when you have a lot of levels to map (EX: mapping states to regions - you wouldn’t want to type that out in an ifelse) - while ifelse might make sense if you have just 2 or 3 levels and you don’t want to create an external csv. This is personal choice - however you want to do your (home)work.</p>
<pre class="r"><code>data.grouped &lt;- data.grouped %&gt;%
  mutate(underwriter2 = ifelse(Val.Year &lt; 2012,&quot;A&quot;,
                            ifelse(Val.Year == 2012 | Val.Year == 2013,&quot;B&quot;,&quot;C&quot;)))</code></pre>
<p>DECONSTRUCT THE CODE ABOVE:</p>
<ul>
<li>Notice the use of “==”. This is used for conditional statements. Assign values with “=” (like in mutate).</li>
<li>The “|” character means OR. Use “&amp;” for AND.</li>
<li>Ifelse works identical to Excel if statement. ifelse(condition,output if TRUE, output if FALSE).</li>
</ul>
<p>TRANSLATE THE CODE TO ENGLISH:</p>
<ul>
<li>Create a new object called data.grouped</li>
<li>Create that object by starting with the existing object data.grouped THEN</li>
<li><p>Add a new column called underwriter2 which is defined as follows:</p></li>
<li>If Valuation Year &lt; 2012: A OTHERWISE</li>
<li>If Valuation Year = 2012 OR Valuation Year = 2013: B OTEHRWISE</li>
<li><p>C</p></li>
</ul>
</div>
<div id="task-6-filter" class="section level1">
<h1>TASK 6: FILTER</h1>
<p>Only look at valuation years where the number of deaths is at least 2000</p>
<pre class="r"><code>data.grouped &lt;- data.grouped %&gt;%
  filter(actual &gt; 2000)</code></pre>
<p>DECONSTRUCT THE CODE ABOVE:</p>
<ul>
<li>Interpret the dplyr function filter() as “only look at rows where (this is true)”</li>
</ul>
<p>TRANSLATE THE CODE TO ENGLISH:</p>
<ul>
<li>Create a new object called data.grouped</li>
<li>Begin with the current object data.grouped THEN</li>
<li>Only look at rows where actual is greater than 2,000</li>
</ul>
<p>May decrease number of rows - will have no impact on the number of columns.</p>
</div>
<div id="task-7-select" class="section level1">
<h1>TASK 7: SELECT</h1>
<p>Remove the column “underwriter2”.</p>
<pre class="r"><code>data.groupeda &lt;- data.grouped %&gt;%
  select(c('Val.Year','actual','expected','underwriter','a.to.e'))</code></pre>
<p>DECONSTRUCT THE CODE ABOVE:</p>
<ul>
<li>c() is the combine function</li>
<li>This creates a vector of elements you define</li>
<li>Use this to apply a function over several arguments - such as several column names</li>
<li>Interpret dplyr function select() as “select only the columns (that are defined here)”</li>
</ul>
<p>TRANSLATE THE CODE TO ENGLISH:</p>
<ul>
<li>Create a new object called data.groupeda</li>
<li>Begin with data.grouped THEN</li>
<li>Select only the columns in this list</li>
</ul>
<p>ALTERNATE METHOD FOR TASK 7</p>
<pre class="r"><code>data.grouped &lt;- data.grouped %&gt;%
  select(-c('underwriter2'))</code></pre>
<p>DECONSTRUCT THE CODE ABOVE:</p>
<ul>
<li>Instead of specifying which columns to select - specify columns NOT to select</li>
<li>This is done by placing a negative sign before c()</li>
</ul>
<p>TRANSLATE THE CODE TO ENGLISH:</p>
<ul>
<li>Create a new object called data.grouped</li>
<li>Begin with the current object data.grouped THEN</li>
<li>Select all columns EXCEPT underwriter2</li>
</ul>
</div>
<div id="summary" class="section level1">
<h1>SUMMARY</h1>
<p>We have now taken the original dataset (data.inforce) THEN</p>
<ul>
<li>We grouped by valuation year THEN summed actual and expected deaths THEN</li>
<li>we added a new column called a.to.e THEN</li>
<li>we joined the valyear table THEN</li>
<li>we filtered out rows with less than 2,000 death THEN</li>
<li>we removed a column</li>
</ul>
<p>This was all done sequentially on the same dataset. This is a good representation of how code is created. Very piecemeal and iterative. It is very rare that you will go into a project knowing all the tasks you will need to complete sequentially. Ultimately, however, you do get to your final result - like in our simplified example above. At this point you can use dplyr and the pipe operator to clean up and chain your code together as follows:</p>
<pre class="r"><code>data.grouped &lt;- data.mortality %&gt;%
  group_by(Val.Year) %&gt;%
  summarise(actual = sum(Deaths), expected = sum(qx2015VBT.policy)) %&gt;%
  mutate(a.to.e = actual/expected) %&gt;%
  inner_join(data.valyear, by = 'Val.Year') %&gt;%
  mutate(underwriter2 = ifelse(Val.Year &lt; 2012,&quot;A&quot;,
                            ifelse(Val.Year == 2012 | Val.Year == 2013,&quot;B&quot;,&quot;C&quot;))) %&gt;%
  filter(actual &gt; 2000) %&gt;%
  select(-c('underwriter2'))</code></pre>
<p>DECONSTRUCT THE CODE ABOVE:</p>
<ul>
<li>There is nothing new here - we just chained (combined) all the steps into one snippet</li>
<li>One nice thing to emphasize with dplyr is that it is sequential</li>
<li>You can create a new variable with one function and use that new variable in a subsequent function</li>
<li>Example is average.size - we did not need to create multiple snippets</li>
</ul>
<p>TRANSLATE THE CODE TO ENGLISH:</p>
<ul>
<li>Create a new object called data.chained</li>
<li>Begin with the current object data.inforce THEN</li>
<li>Group by port opt model THEN</li>
<li>Sum total premium and count total policies THEN</li>
<li>Calculate average size as premium divided by count THEN</li>
<li>Join to the port opt table by the field “POP_IND”</li>
<li>Use the mutate function to map the port opt levels to categories THEN</li>
<li>Only keep rows with average size greater than 100k THEN</li>
<li>Select all columns EXCEPT portopt.map</li>
</ul>
<p>The snippet above replaces all the operations before it. This is much more elegant and efficient - but nearly impossible to conceptualize without some iteration. This also demonstrates the potential of dplyr. Several data manipulations can be coded to happen sequentially - and very quickly. The 6 functions demonstrated here are only a glimps of what dplyr and R can do. As you begin using R for more tasks, you will discover many more useful packages and functions. Googling when you are stuck is encouraged.</p>
<p>This concludes the presentation. Next step: HOMEWORK</p>
</div>
<div id="task-8-your-homework-assignment" class="section level1">
<h1>TASK 8: YOUR HOMEWORK ASSIGNMENT</h1>
<p>For policies issued in 2019:</p>
<ul>
<li>Average by gender.</li>
<li>Average size by banded age by gender.</li>
<li>Average size by banded age by with or without a VAGLB rider.</li>
</ul>
<p>For policies issued any year:</p>
<ul>
<li>Total premium issued by issue year.</li>
<li>Total premium issued by product by issue year.</li>
</ul>
<p>Create a separate object for each of the bullet points above.</p>
<p>Should be done in multiple code snippets - but can be all done in one .R file.</p>
<p>For banded ages use the following mapping rules:</p>
<ul>
<li>0-49: 40</li>
<li>50-59: 55</li>
<li>60-69: 65</li>
<li>70-79: 75</li>
<li>80+ : 85</li>
</ul>
<p>Save your script as a .r file and send to me if you would like it reviewed. We will be building on this script in our class next week: DATA VISUALIZATION WITH GGPLOT2.</p>
<p>There are many ways to get the correct answer - but there is only one correct answer. I will send a sample solution along with expected output with next week’s materials.</p>
</div>
<div id="thank-you" class="section level1">
<h1>THANK YOU</h1>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
